@using System.Globalization
@using Fig.Common.Constants
@using Fig.Common.NetStandard.Scripting
@using Fig.Web.Models.Setting.ConfigurationModels.DataGrid

@if (Model.IsSecret)
{
    <RadzenPassword Value="@(StringModel.Value != SecretConstants.SecretPlaceholder && !string.IsNullOrWhiteSpace(StringModel.Value) ? StringModel.Value : string.Empty)"  
                    @oninput="SetValue" Placeholder="@Placeholder" Style="width: 100%" @onkeydown="HandleKeyDown"/>
}
else if (Model.EditorLineCount == null)
{
    <RadzenTextBox Value="@StringModel.Value" @oninput="SetValue" Style="width: 100%" @onkeydown="HandleKeyDown"/>
}
else
{
    @* Multi-line text areas should not save on Enter - Enter creates new lines *@
    <RadzenTextArea @bind-Value=@StringModel.Value Rows="@Model.EditorLineCount.Value" Style="width: 100%"/>
}

@code {

    [Parameter]
    public IDataGridValueModel Model { get; set; } = null!;
    
    [Parameter]
    public EventCallback OnEnterPressed { get; set; }

    private string Placeholder
    {
        get
        {
            if (string.IsNullOrWhiteSpace(StringModel.Value))
                return "Enter initial value";

            return "Enter updated value";
        }
    }

    private DataGridValueModel<string> StringModel => (Model as DataGridValueModel<string>)!;

    private Task SetValue(ChangeEventArgs args)
    {
        StringModel.Value = Convert.ToString(args.Value, CultureInfo.InvariantCulture);
        return Task.CompletedTask;
    }
    
    private async Task HandleKeyDown(KeyboardEventArgs e)
    {
        if (e.Key == "Enter")
        {
            await OnEnterPressed.InvokeAsync();
        }
    }
}