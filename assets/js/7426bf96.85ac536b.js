"use strict";(self.webpackChunkfig_documentation=self.webpackChunkfig_documentation||[]).push([[9811],{2981:(e,n,i)=>{i.r(n),i.d(n,{assets:()=>l,contentTitle:()=>a,default:()=>g,frontMatter:()=>r,metadata:()=>t,toc:()=>c});const t=JSON.parse('{"id":"guides/integration-testing","title":"Integration Testing ASP.NET Core Apps","description":"If your application uses Fig for configuration then you have some options when it comes to integration testing. The first option is to use Fig for configuration as part of your integration test. However, this means you are essentially integration testing the Fig application too and is probably not desirable in most cases. The other option involves disabling fig and injecting in a different configuration provider for the tests. Fig comes packaged with a convenient reloadable configuration provider which makes updating configuraiton in integration tests very easy.","source":"@site/docs/guides/integration-testing.md","sourceDirName":"guides","slug":"/guides/integration-testing","permalink":"/docs/guides/integration-testing","draft":false,"unlisted":false,"editUrl":"https://github.com/mzbrau/fig/tree/main/doc/fig-documentation/docs/guides/integration-testing.md","tags":[],"version":"current","sidebarPosition":4,"frontMatter":{"sidebar_position":4},"sidebar":"tutorialSidebar","previous":{"title":"Encrypting Client Secrets","permalink":"/docs/guides/encrypting-secrets-dpapi"},"next":{"title":"Configuring TLS","permalink":"/docs/guides/configuring-tls"}}');var o=i(4848),s=i(8453);const r={sidebar_position:4},a="Integration Testing ASP.NET Core Apps",l={},c=[];function d(e){const n={code:"code",h1:"h1",header:"header",li:"li",ol:"ol",p:"p",pre:"pre",...(0,s.R)(),...e.components};return(0,o.jsxs)(o.Fragment,{children:[(0,o.jsx)(n.header,{children:(0,o.jsx)(n.h1,{id:"integration-testing-aspnet-core-apps",children:"Integration Testing ASP.NET Core Apps"})}),"\n",(0,o.jsx)(n.p,{children:"If your application uses Fig for configuration then you have some options when it comes to integration testing. The first option is to use Fig for configuration as part of your integration test. However, this means you are essentially integration testing the Fig application too and is probably not desirable in most cases. The other option involves disabling fig and injecting in a different configuration provider for the tests. Fig comes packaged with a convenient reloadable configuration provider which makes updating configuraiton in integration tests very easy."}),"\n",(0,o.jsx)(n.p,{children:"To get started, do the following."}),"\n",(0,o.jsxs)(n.ol,{children:["\n",(0,o.jsxs)(n.li,{children:["\n",(0,o.jsx)(n.p,{children:"Disable the FigConfigurationProvider"}),"\n",(0,o.jsx)(n.p,{children:"There are 2 ways to disable the provider, the first is to remove the FIG_API_URI environment variable, but this means tests will be flakey depending on the environment. A better way is to pass in a command line argument."}),"\n",(0,o.jsx)(n.p,{children:"In your program.cs file, make sure you are passing the command line arguments to Fig."}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-csharp",children:'builder.Configuration.SetBasePath(GetBasePath())\n    .AddFig<Settings>(options =>\n    {\n        options.ClientName = "AspNetApi";\n        options.CommandLineArgs = args;\n    });\n'})}),"\n",(0,o.jsx)(n.p,{children:"Then, in your integration test, add the following line into your WebApplicationFactory setup:"}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-csharp",children:"builder.DisableFig();\n"})}),"\n",(0,o.jsx)(n.p,{children:"This will pass in a command line argument which will result in Fig being disabled"}),"\n"]}),"\n",(0,o.jsxs)(n.li,{children:["\n",(0,o.jsx)(n.p,{children:"Inject the reloadable configuration provider"}),"\n",(0,o.jsx)(n.p,{children:"This configuration provider allows you to pass in your settings class and reload it at will to update the configuration of your application."}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-csharp",children:"var settings = new Settings();\nvar configReloader = new ConfigReloader()\nbuilder.ConfigureAppConfiguration((a, conf) =>\n{\n    conf.AddIntegrationTestConfiguration(configReloader, settings);\n    conf.Build();\n});\n"})}),"\n",(0,o.jsx)(n.p,{children:"Passing the settings in initially is optional and allows for the initial configuraiton. After that, settings can be updated as follows:"}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-csharp",children:'settings.MyProperty = "NewValue";\nconfigReloader.Reload(settings);\n'})}),"\n"]}),"\n",(0,o.jsxs)(n.li,{children:["\n",(0,o.jsx)(n.p,{children:"Write your tests and update the value accordingly."}),"\n"]}),"\n"]}),"\n",(0,o.jsx)(n.p,{children:"A full example looks like the following:"}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-csharp",children:'var settings = new Settings();\n// This will set an initial configuration value\nsettings.MyProperty = "OriginalValue";\nvar configReloader = new ConfigReloader()\nvar application = new WebApplicationFactory<Worker>().WithWebHostBuilder(builder =>\n{\n    builder.DisableFig();\n    builder.ConfigureAppConfiguration((a, conf) =>\n    {\n        conf.AddIntegrationTestConfiguration(ConfigReloader, Settings);\n        conf.Build();\n    });\n\n    builder.ConfigureServices((_, services) =>\n    {\n        // Override any registrations here.\n    });\n});\n\nvar client = application.CreateClient();\n\nsettings.MyProperty = "NewValue"\n// Value will be updated.\nconfigReloader.Reload(settings);\n\n'})})]})}function g(e={}){const{wrapper:n}={...(0,s.R)(),...e.components};return n?(0,o.jsx)(n,{...e,children:(0,o.jsx)(d,{...e})}):d(e)}},8453:(e,n,i)=>{i.d(n,{R:()=>r,x:()=>a});var t=i(6540);const o={},s=t.createContext(o);function r(e){const n=t.useContext(s);return t.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function a(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(o):e.components||o:r(e.components),t.createElement(s.Provider,{value:n},e.children)}}}]);