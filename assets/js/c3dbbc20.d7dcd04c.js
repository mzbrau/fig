"use strict";(self.webpackChunkfig_documentation=self.webpackChunkfig_documentation||[]).push([[9216],{3725:(e,i,n)=>{n.r(i),n.d(i,{assets:()=>l,contentTitle:()=>a,default:()=>g,frontMatter:()=>r,metadata:()=>t,toc:()=>c});const t=JSON.parse('{"id":"guides/integration-testing","title":"Integration Testing ASP.NET Core Apps","description":"If your application uses Fig for configuration then you have some options when it comes to integration testing. The first option is to use Fig for configuration as part of your integration test. However, this means you are essentially integration testing the Fig application too and is probably not desirable in most cases. The other option involves disabling fig and injecting in a different configuration provider for the tests. Fig comes packaged with a convenient reloadable configuration provider which makes updating configuration in integration tests very easy.","source":"@site/docs/guides/4-integration-testing.md","sourceDirName":"guides","slug":"/guides/integration-testing","permalink":"/docs/next/guides/integration-testing","draft":false,"unlisted":false,"editUrl":"https://github.com/mzbrau/fig/tree/main/doc/fig-documentation/docs/guides/4-integration-testing.md","tags":[],"version":"current","sidebarPosition":4,"frontMatter":{"sidebar_position":4},"sidebar":"tutorialSidebar","previous":{"title":"Encrypting Client Secrets","permalink":"/docs/next/guides/encrypting-secrets-dpapi"},"next":{"title":"Configuring TLS","permalink":"/docs/next/guides/configuring-tls"}}');var s=n(4848),o=n(8453);const r={sidebar_position:4},a="Integration Testing ASP.NET Core Apps",l={},c=[{value:"Prerequisites",id:"prerequisites",level:2},{value:"Getting Started",id:"getting-started",level:2},{value:"Related Testing Approaches",id:"related-testing-approaches",level:2},{value:"Display Script Testing",id:"display-script-testing",level:3}];function d(e){const i={a:"a",admonition:"admonition",code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",li:"li",ol:"ol",p:"p",pre:"pre",ul:"ul",...(0,o.R)(),...e.components};return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(i.header,{children:(0,s.jsx)(i.h1,{id:"integration-testing-aspnet-core-apps",children:"Integration Testing ASP.NET Core Apps"})}),"\n",(0,s.jsx)(i.p,{children:"If your application uses Fig for configuration then you have some options when it comes to integration testing. The first option is to use Fig for configuration as part of your integration test. However, this means you are essentially integration testing the Fig application too and is probably not desirable in most cases. The other option involves disabling fig and injecting in a different configuration provider for the tests. Fig comes packaged with a convenient reloadable configuration provider which makes updating configuration in integration tests very easy."}),"\n",(0,s.jsx)(i.admonition,{title:"Related Testing",type:"note",children:(0,s.jsxs)(i.p,{children:["This guide covers integration testing of ASP.NET Core applications that use Fig for configuration. If you're looking to test Fig display scripts, see the ",(0,s.jsx)(i.a,{href:"/docs/next/guides/display-script-testing",children:"Display Script Testing"})," guide which covers testing the JavaScript logic in your Fig display scripts."]})}),"\n",(0,s.jsx)(i.h2,{id:"prerequisites",children:"Prerequisites"}),"\n",(0,s.jsx)(i.p,{children:"Before you can write integration tests for your Fig-enabled application, you need to add the Fig Client Testing package to your test project:"}),"\n",(0,s.jsx)(i.pre,{children:(0,s.jsx)(i.code,{className:"language-xml",children:'<PackageReference Include="Fig.Client.Testing" Version="latest" />\n'})}),"\n",(0,s.jsx)(i.p,{children:"This package provides the testing utilities needed for both integration testing and display script testing."}),"\n",(0,s.jsx)(i.h2,{id:"getting-started",children:"Getting Started"}),"\n",(0,s.jsx)(i.p,{children:"To get started with integration testing, do the following."}),"\n",(0,s.jsxs)(i.ol,{children:["\n",(0,s.jsxs)(i.li,{children:["\n",(0,s.jsx)(i.p,{children:"Disable the FigConfigurationProvider"}),"\n",(0,s.jsx)(i.p,{children:"There are 2 ways to disable the provider, the first is to remove the FIG_API_URI environment variable, but this means tests will be flakey depending on the environment. A better way is to pass in a command line argument."}),"\n",(0,s.jsx)(i.p,{children:"In your program.cs file, make sure you are passing the command line arguments to Fig."}),"\n",(0,s.jsx)(i.pre,{children:(0,s.jsx)(i.code,{className:"language-csharp",children:'builder.Configuration.SetBasePath(GetBasePath())\n    .AddFig<Settings>(options =>\n    {\n        options.ClientName = "AspNetApi";\n        options.CommandLineArgs = args;\n    });\n'})}),"\n",(0,s.jsx)(i.p,{children:"Then, in your integration test, add the following line into your WebApplicationFactory setup:"}),"\n",(0,s.jsx)(i.pre,{children:(0,s.jsx)(i.code,{className:"language-csharp",children:"builder.DisableFig();\n"})}),"\n",(0,s.jsx)(i.p,{children:"This will pass in a command line argument which will result in Fig being disabled"}),"\n"]}),"\n",(0,s.jsxs)(i.li,{children:["\n",(0,s.jsx)(i.p,{children:"Inject the reloadable configuration provider"}),"\n",(0,s.jsx)(i.p,{children:"This configuration provider allows you to pass in your settings class and reload it at will to update the configuration of your application."}),"\n",(0,s.jsx)(i.pre,{children:(0,s.jsx)(i.code,{className:"language-csharp",children:"var settings = new Settings();\nvar configReloader = new ConfigReloader()\nbuilder.ConfigureAppConfiguration((a, conf) =>\n{\n    conf.AddIntegrationTestConfiguration(configReloader, settings);\n    conf.Build();\n});\n"})}),"\n",(0,s.jsx)(i.p,{children:"Passing the settings in initially is optional and allows for the initial configuration. After that, settings can be updated as follows:"}),"\n",(0,s.jsx)(i.pre,{children:(0,s.jsx)(i.code,{className:"language-csharp",children:'settings.MyProperty = "NewValue";\nconfigReloader.Reload(settings);\n'})}),"\n"]}),"\n",(0,s.jsxs)(i.li,{children:["\n",(0,s.jsx)(i.p,{children:"Write your tests and update the value accordingly."}),"\n"]}),"\n"]}),"\n",(0,s.jsx)(i.p,{children:"A full example looks like the following:"}),"\n",(0,s.jsx)(i.pre,{children:(0,s.jsx)(i.code,{className:"language-csharp",children:'var settings = new Settings();\n// This will set an initial configuration value\nsettings.MyProperty = "OriginalValue";\nvar configReloader = new ConfigReloader()\nvar application = new WebApplicationFactory<Worker>().WithWebHostBuilder(builder =>\n{\n    builder.DisableFig();\n    builder.ConfigureAppConfiguration((a, conf) =>\n    {\n        conf.AddIntegrationTestConfiguration(ConfigReloader, Settings);\n        conf.Build();\n    });\n\n    builder.ConfigureServices((_, services) =>\n    {\n        // Override any registrations here.\n    });\n});\n\nvar client = application.CreateClient();\n\nsettings.MyProperty = "NewValue"\n// Value will be updated.\nconfigReloader.Reload(settings);\n\n'})}),"\n",(0,s.jsx)(i.h2,{id:"related-testing-approaches",children:"Related Testing Approaches"}),"\n",(0,s.jsx)(i.p,{children:"While this guide focuses on integration testing your ASP.NET Core application with Fig configuration, you may also want to test other aspects of your Fig setup:"}),"\n",(0,s.jsx)(i.h3,{id:"display-script-testing",children:"Display Script Testing"}),"\n",(0,s.jsx)(i.p,{children:"If your Fig settings include display scripts (JavaScript code that controls validation, visibility, or other UI behavior), you should also test these scripts to ensure they work correctly. The Fig Client Testing package (which you've already added for integration testing) also provides comprehensive tools for testing display scripts."}),"\n",(0,s.jsxs)(i.p,{children:["See the ",(0,s.jsx)(i.a,{href:"/docs/next/guides/display-script-testing",children:"Display Script Testing"})," guide to learn how to:"]}),"\n",(0,s.jsxs)(i.ul,{children:["\n",(0,s.jsx)(i.li,{children:"Test display script validation logic"}),"\n",(0,s.jsx)(i.li,{children:"Verify conditional visibility and categorization"}),"\n",(0,s.jsx)(i.li,{children:"Test complex business rules in your scripts"}),"\n",(0,s.jsx)(i.li,{children:"Run display script tests in CI/CD pipelines"}),"\n"]}),"\n",(0,s.jsxs)(i.p,{children:["Both integration testing and display script testing use the same ",(0,s.jsx)(i.code,{children:"Fig.Client.Testing"})," NuGet package, making it easy to test all aspects of your Fig configuration in a unified testing approach."]})]})}function g(e={}){const{wrapper:i}={...(0,o.R)(),...e.components};return i?(0,s.jsx)(i,{...e,children:(0,s.jsx)(d,{...e})}):d(e)}},8453:(e,i,n)=>{n.d(i,{R:()=>r,x:()=>a});var t=n(6540);const s={},o=t.createContext(s);function r(e){const i=t.useContext(o);return t.useMemo((function(){return"function"==typeof e?e(i):{...i,...e}}),[i,e])}function a(e){let i;return i=e.disableParentContext?"function"==typeof e.components?e.components(s):e.components||s:r(e.components),t.createElement(o.Provider,{value:i},e.children)}}}]);