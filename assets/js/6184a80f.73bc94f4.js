"use strict";(self.webpackChunkfig_documentation=self.webpackChunkfig_documentation||[]).push([[9305],{3575:(e,t,n)=>{n.r(t),n.d(t,{assets:()=>l,contentTitle:()=>r,default:()=>g,frontMatter:()=>o,metadata:()=>i,toc:()=>d});const i=JSON.parse('{"id":"features/metadata-properties","title":"Metadata Properties","description":"Fig automatically tracks when your settings are loaded and updated, providing you with metadata about the state of your configuration. This feature is particularly useful for monitoring, debugging, and implementing health checks in your applications.","source":"@site/versioned_docs/version-2.0/features/29-metadata-properties.md","sourceDirName":"features","slug":"/features/metadata-properties","permalink":"/docs/features/metadata-properties","draft":false,"unlisted":false,"editUrl":"https://github.com/mzbrau/fig/tree/main/doc/fig-documentation/versioned_docs/version-2.0/features/29-metadata-properties.md","tags":[],"version":"2.0","sidebarPosition":29,"frontMatter":{"sidebar_position":29,"sidebar_label":"Metadata Properties"},"sidebar":"tutorialSidebar","previous":{"title":"Google Cloud Client Secret Provider","permalink":"/docs/features/client-secrets/google-secret-provider"},"next":{"title":"Guides","permalink":"/docs/category/guides"}}');var s=n(4848),a=n(8453);const o={sidebar_position:29,sidebar_label:"Metadata Properties"},r="Metadata Properties",l={},d=[{value:"Available Properties",id:"available-properties",level:2},{value:"LastFigUpdateUtc",id:"lastfigupdateutc",level:3},{value:"FigSettingLoadType",id:"figsettingloadtype",level:3},{value:"Common Use Cases",id:"common-use-cases",level:2},{value:"Health Checks",id:"health-checks",level:3},{value:"Monitoring and Alerting",id:"monitoring-and-alerting",level:3},{value:"Conditional Logic Based on Settings Age",id:"conditional-logic-based-on-settings-age",level:3},{value:"Important Notes",id:"important-notes",level:2}];function c(e){const t={code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",li:"li",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,a.R)(),...e.components};return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(t.header,{children:(0,s.jsx)(t.h1,{id:"metadata-properties",children:"Metadata Properties"})}),"\n",(0,s.jsx)(t.p,{children:"Fig automatically tracks when your settings are loaded and updated, providing you with metadata about the state of your configuration. This feature is particularly useful for monitoring, debugging, and implementing health checks in your applications."}),"\n",(0,s.jsx)(t.h2,{id:"available-properties",children:"Available Properties"}),"\n",(0,s.jsxs)(t.p,{children:["All settings classes that inherit from ",(0,s.jsx)(t.code,{children:"SettingsBase"})," automatically include two properties that provide information about the last update:"]}),"\n",(0,s.jsx)(t.h3,{id:"lastfigupdateutc",children:"LastFigUpdateUtc"}),"\n",(0,s.jsxs)(t.p,{children:["A ",(0,s.jsx)(t.code,{children:"DateTime?"})," property that indicates when the settings were last successfully loaded or updated."]}),"\n",(0,s.jsx)(t.pre,{children:(0,s.jsx)(t.code,{className:"language-csharp",children:'public class MySettings : SettingsBase\n{\n    public string DatabaseConnection { get; set; }\n    public int RetryCount { get; set; }\n    \n    // Inherited from SettingsBase\n    // public DateTime? LastFigUpdateUtc { get; }\n}\n\n// Usage\nvar settings = serviceProvider.GetRequiredService<IOptionsMonitor<MySettings>>();\nvar lastUpdate = settings.CurrentValue.LastFigUpdateUtc;\n\nif (lastUpdate.HasValue)\n{\n    Console.WriteLine($"Settings last updated: {lastUpdate.Value:yyyy-MM-dd HH:mm:ss} UTC");\n}\nelse\n{\n    Console.WriteLine("Settings have not been successfully loaded");\n}\n'})}),"\n",(0,s.jsx)(t.h3,{id:"figsettingloadtype",children:"FigSettingLoadType"}),"\n",(0,s.jsx)(t.p,{children:"An enum property that indicates how the settings were loaded. This helps you understand whether your application is running with the latest server configuration or fallback values."}),"\n",(0,s.jsx)(t.pre,{children:(0,s.jsx)(t.code,{className:"language-csharp",children:'public enum LoadType\n{\n    None,    // Settings failed to load completely\n    Server,  // Settings loaded from Fig API\n    Offline  // Settings loaded from offline cache\n}\n\n// Usage\nvar settings = serviceProvider.GetRequiredService<IOptionsMonitor<MySettings>>();\nvar loadType = settings.CurrentValue.FigSettingLoadType;\n\nswitch (loadType)\n{\n    case LoadType.Server:\n        Console.WriteLine("\u2713 Running with latest settings from Fig API");\n        break;\n    case LoadType.Offline:\n        Console.WriteLine("\u26a0 Running with cached settings (API unavailable)");\n        break;\n    case LoadType.None:\n        Console.WriteLine("\u274c Running with default values (no settings loaded)");\n        break;\n}\n'})}),"\n",(0,s.jsx)(t.h2,{id:"common-use-cases",children:"Common Use Cases"}),"\n",(0,s.jsx)(t.h3,{id:"health-checks",children:"Health Checks"}),"\n",(0,s.jsx)(t.p,{children:"Use these properties to implement health checks that verify your application has successfully loaded recent settings:"}),"\n",(0,s.jsx)(t.pre,{children:(0,s.jsx)(t.code,{className:"language-csharp",children:'public class SettingsHealthCheck : IHealthCheck\n{\n    private readonly IOptionsMonitor<MySettings> _settings;\n    private readonly TimeSpan _maxAge;\n\n    public SettingsHealthCheck(IOptionsMonitor<MySettings> settings)\n    {\n        _settings = settings;\n        _maxAge = TimeSpan.FromMinutes(30); // Consider settings stale after 30 minutes\n    }\n\n    public Task<HealthCheckResult> CheckHealthAsync(HealthCheckContext context, \n        CancellationToken cancellationToken = default)\n    {\n        var currentSettings = _settings.CurrentValue;\n        \n        // Check if settings loaded successfully\n        if (currentSettings.FigSettingLoadType == LoadType.None)\n        {\n            return Task.FromResult(HealthCheckResult.Unhealthy(\n                "Fig settings failed to load"));\n        }\n        \n        // Check if settings are recent\n        if (currentSettings.LastFigUpdateUtc.HasValue)\n        {\n            var age = DateTime.UtcNow - currentSettings.LastFigUpdateUtc.Value;\n            if (age > _maxAge)\n            {\n                return Task.FromResult(HealthCheckResult.Degraded(\n                    $"Fig settings are {age.TotalMinutes:F1} minutes old"));\n            }\n        }\n        \n        var message = currentSettings.FigSettingLoadType == LoadType.Server \n            ? "Fig settings loaded from server" \n            : "Fig settings loaded from offline cache";\n            \n        return Task.FromResult(HealthCheckResult.Healthy(message));\n    }\n}\n'})}),"\n",(0,s.jsx)(t.h3,{id:"monitoring-and-alerting",children:"Monitoring and Alerting"}),"\n",(0,s.jsx)(t.p,{children:"Monitor your application's configuration state:"}),"\n",(0,s.jsx)(t.pre,{children:(0,s.jsx)(t.code,{className:"language-csharp",children:'public class SettingsMonitor\n{\n    private readonly IOptionsMonitor<MySettings> _settings;\n    private readonly ILogger<SettingsMonitor> _logger;\n\n    public SettingsMonitor(IOptionsMonitor<MySettings> settings, ILogger<SettingsMonitor> logger)\n    {\n        _settings = settings;\n        _logger = logger;\n        \n        // Monitor for settings changes\n        _settings.OnChange(OnSettingsChanged);\n    }\n\n    private void OnSettingsChanged(MySettings settings)\n    {\n        var loadType = settings.FigSettingLoadType;\n        var lastUpdate = settings.LastFigUpdateUtc;\n        \n        _logger.LogInformation("Settings updated - LoadType: {LoadType}, LastUpdate: {LastUpdate}", \n            loadType, lastUpdate);\n            \n        // Send metrics to your monitoring system\n        if (loadType == LoadType.Offline)\n        {\n            _logger.LogWarning("Application running with offline settings cache");\n        }\n    }\n}\n'})}),"\n",(0,s.jsx)(t.h3,{id:"conditional-logic-based-on-settings-age",children:"Conditional Logic Based on Settings Age"}),"\n",(0,s.jsx)(t.p,{children:"Implement different behavior based on how recently settings were updated:"}),"\n",(0,s.jsx)(t.pre,{children:(0,s.jsx)(t.code,{className:"language-csharp",children:"public class DataService\n{\n    private readonly IOptionsMonitor<MySettings> _settings;\n\n    public async Task ProcessDataAsync()\n    {\n        var currentSettings = _settings.CurrentValue;\n        \n        // Use more conservative timeouts if settings are old or offline\n        var timeout = GetTimeoutBasedOnSettingsAge(currentSettings);\n        \n        using var httpClient = new HttpClient { Timeout = timeout };\n        // ... rest of implementation\n    }\n\n    private TimeSpan GetTimeoutBasedOnSettingsAge(MySettings settings)\n    {\n        // If settings failed to load, use conservative defaults\n        if (settings.FigSettingLoadType == LoadType.None)\n        {\n            return TimeSpan.FromSeconds(30);\n        }\n        \n        // If using offline settings, be more conservative\n        if (settings.FigSettingLoadType == LoadType.Offline)\n        {\n            return TimeSpan.FromSeconds(settings.TimeoutSeconds + 10);\n        }\n        \n        // If settings are very recent, use configured value\n        if (settings.LastFigUpdateUtc.HasValue && \n            DateTime.UtcNow - settings.LastFigUpdateUtc.Value < TimeSpan.FromMinutes(5))\n        {\n            return TimeSpan.FromSeconds(settings.TimeoutSeconds);\n        }\n        \n        // Default to slightly more conservative timeout\n        return TimeSpan.FromSeconds(settings.TimeoutSeconds + 5);\n    }\n}\n"})}),"\n",(0,s.jsx)(t.h2,{id:"important-notes",children:"Important Notes"}),"\n",(0,s.jsxs)(t.ul,{children:["\n",(0,s.jsxs)(t.li,{children:[(0,s.jsx)(t.strong,{children:"UTC Timestamps"}),": ",(0,s.jsx)(t.code,{children:"LastFigUpdateUtc"})," is always in UTC to avoid timezone confusion"]}),"\n",(0,s.jsxs)(t.li,{children:[(0,s.jsx)(t.strong,{children:"Null Values"}),": ",(0,s.jsx)(t.code,{children:"LastFigUpdateUtc"})," will be ",(0,s.jsx)(t.code,{children:"null"})," if settings have never been successfully loaded"]}),"\n",(0,s.jsxs)(t.li,{children:[(0,s.jsx)(t.strong,{children:"Automatic Updates"}),": These properties are automatically updated whenever Fig reloads your settings"]}),"\n",(0,s.jsxs)(t.li,{children:[(0,s.jsx)(t.strong,{children:"Thread Safety"}),": These properties are updated atomically when settings change"]}),"\n",(0,s.jsxs)(t.li,{children:[(0,s.jsx)(t.strong,{children:"Default Values"}),": When ",(0,s.jsx)(t.code,{children:"LoadType.None"}),", your application runs with the default values defined in your settings class"]}),"\n"]})]})}function g(e={}){const{wrapper:t}={...(0,a.R)(),...e.components};return t?(0,s.jsx)(t,{...e,children:(0,s.jsx)(c,{...e})}):c(e)}},8453:(e,t,n)=>{n.d(t,{R:()=>o,x:()=>r});var i=n(6540);const s={},a=i.createContext(s);function o(e){const t=i.useContext(a);return i.useMemo(function(){return"function"==typeof e?e(t):{...t,...e}},[t,e])}function r(e){let t;return t=e.disableParentContext?"function"==typeof e.components?e.components(s):e.components||s:o(e.components),i.createElement(a.Provider,{value:t},e.children)}}}]);