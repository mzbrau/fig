"use strict";(globalThis.webpackChunkfig_documentation=globalThis.webpackChunkfig_documentation||[]).push([[1912],{11836(e,i,n){n.r(i),n.d(i,{assets:()=>c,contentTitle:()=>o,default:()=>g,frontMatter:()=>a,metadata:()=>t,toc:()=>d});const t=JSON.parse('{"id":"guides/aspire-integration","title":".NET Aspire Integration","description":".NET Aspire is a cloud-ready stack for building observable, production-ready, distributed applications. Fig integrates seamlessly with .NET Aspire through the Fig.Aspire NuGet package, allowing you to easily add Fig\'s centralized configuration management to your Aspire applications.","source":"@site/docs/guides/9-aspire-integration.md","sourceDirName":"guides","slug":"/guides/aspire-integration","permalink":"/docs/next/guides/aspire-integration","draft":false,"unlisted":false,"editUrl":"https://github.com/mzbrau/fig/tree/main/doc/fig-documentation/docs/guides/9-aspire-integration.md","tags":[],"version":"current","sidebarPosition":9,"frontMatter":{"sidebar_position":9},"sidebar":"tutorialSidebar","previous":{"title":"Display Script Testing","permalink":"/docs/next/guides/display-script-testing"},"next":{"title":"Integration Points","permalink":"/docs/next/category/integration-points"}}');var r=n(74848),s=n(28453);const a={sidebar_position:9},o=".NET Aspire Integration",c={},d=[{value:"Prerequisites",id:"prerequisites",level:2},{value:"Quick Start",id:"quick-start",level:2},{value:"Configuration Options",id:"configuration-options",level:3},{value:"Database Configuration",id:"database-configuration",level:2},{value:"Alternative",id:"alternative",level:2},{value:"Client Configuration in Your Services",id:"client-configuration-in-your-services",level:2},{value:"Managing Aspire Set Settings",id:"managing-aspire-set-settings",level:2},{value:"Troubleshooting",id:"troubleshooting",level:2},{value:"Service Can&#39;t Connect to Fig API",id:"service-cant-connect-to-fig-api",level:3},{value:"Fig Web Can&#39;t Connect to Fig API",id:"fig-web-cant-connect-to-fig-api",level:3},{value:"Containers Keep Restarting",id:"containers-keep-restarting",level:3}];function l(e){const i={a:"a",blockquote:"blockquote",code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",li:"li",ol:"ol",p:"p",pre:"pre",...(0,s.R)(),...e.components};return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(i.header,{children:(0,r.jsx)(i.h1,{id:"net-aspire-integration",children:".NET Aspire Integration"})}),"\n",(0,r.jsxs)(i.p,{children:[".NET Aspire is a cloud-ready stack for building observable, production-ready, distributed applications. Fig integrates seamlessly with .NET Aspire through the ",(0,r.jsx)(i.code,{children:"Fig.Aspire"})," NuGet package, allowing you to easily add Fig's centralized configuration management to your Aspire applications."]}),"\n",(0,r.jsx)(i.h2,{id:"prerequisites",children:"Prerequisites"}),"\n",(0,r.jsx)(i.p,{children:"Before you can use Fig with .NET Aspire, you need to:"}),"\n",(0,r.jsxs)(i.ol,{children:["\n",(0,r.jsx)(i.li,{children:"Have a .NET Aspire application set up (AppHost project)"}),"\n",(0,r.jsx)(i.li,{children:"Install the Fig.Aspire NuGet package in your AppHost project:"}),"\n"]}),"\n",(0,r.jsx)(i.pre,{children:(0,r.jsx)(i.code,{className:"language-xml",children:'<PackageReference Include="Fig.Aspire" Version="latest" />\n'})}),"\n",(0,r.jsx)(i.h2,{id:"quick-start",children:"Quick Start"}),"\n",(0,r.jsx)(i.p,{children:"The simplest way to add Fig to your Aspire application is to use the convenience method that adds both the Fig API and Fig Web:"}),"\n",(0,r.jsx)(i.pre,{children:(0,r.jsx)(i.code,{className:"language-csharp",children:'var builder = DistributedApplication.CreateBuilder(args);\n\nvar figApi = builder.AddFigApi("fig-api");\nvar figWeb = builder.AddFigWeb("fig-web")\n    .WithFigApiReference(figApi);\n\n// Reference Fig API in your services\nbuilder.AddProject<Projects.InventoryService>("inventoryservice")\n    .WithReference(figApi);\n\nbuilder.AddProject<Projects.OrderService>("orderservice")\n    .WithReference(figApi);\n\nbuilder.Build().Run();\n'})}),"\n",(0,r.jsxs)(i.p,{children:["When you use ",(0,r.jsx)(i.code,{children:"WithReference(figApi)"}),", an environment variable named ",(0,r.jsx)(i.code,{children:"FIG_API_URI"})," is automatically injected into your service, pointing to the Fig API endpoint."]}),"\n",(0,r.jsx)(i.h3,{id:"configuration-options",children:"Configuration Options"}),"\n",(0,r.jsxs)(i.p,{children:["The ",(0,r.jsx)(i.code,{children:"AddFigApi"})," method supports several configuration options:"]}),"\n",(0,r.jsx)(i.pre,{children:(0,r.jsx)(i.code,{className:"language-csharp",children:'var figApi = builder.AddFigApi(\n    name: "fig-api",           // Resource name\n    port: 7281,                // Optional: Host port (random if not specified)\n    tag: "latest"              // Optional: Docker image tag\n);\n'})}),"\n",(0,r.jsxs)(i.p,{children:["The ",(0,r.jsx)(i.code,{children:"AddFigWeb"})," method supports similar configuration options:"]}),"\n",(0,r.jsx)(i.pre,{children:(0,r.jsx)(i.code,{className:"language-csharp",children:'var figWeb = builder.AddFigWeb(\n    name: "fig-web",           // Resource name\n    port: 7148,                // Optional: Host port (random if not specified)\n    tag: "latest"              // Optional: Docker image tag\n);\n'})}),"\n",(0,r.jsx)(i.h2,{id:"database-configuration",children:"Database Configuration"}),"\n",(0,r.jsx)(i.p,{children:"By default, Fig API uses an embedded SQLite database. For production use, you can configure it to use SQL Server."}),"\n",(0,r.jsxs)(i.ol,{children:["\n",(0,r.jsx)(i.li,{children:"Add your connection string to the AppHost's configuration (e.g., user secrets):"}),"\n"]}),"\n",(0,r.jsx)(i.pre,{children:(0,r.jsx)(i.code,{className:"language-json",children:'{\n  "ConnectionStrings": {\n    "FigDb": "Server=myServerAddress;Database=myDataBase;User Id=myUsername;Password=myPassword;"\n  }\n}\n'})}),"\n",(0,r.jsxs)(i.ol,{start:"2",children:["\n",(0,r.jsxs)(i.li,{children:["In your AppHost ",(0,r.jsx)(i.code,{children:"Program.cs"}),", register the connection string and pass it to the Fig API resource:"]}),"\n"]}),"\n",(0,r.jsx)(i.pre,{children:(0,r.jsx)(i.code,{className:"language-csharp",children:'var figDb = builder.AddConnectionString("FigDb");\n\nvar figApi = builder.AddFigApi("fig-api")\n    .WithReference(figDb, "Fig");\n'})}),"\n",(0,r.jsxs)(i.blockquote,{children:["\n",(0,r.jsxs)(i.p,{children:["Note: We use ",(0,r.jsx)(i.code,{children:'WithReference(figDb, "Fig")'}),' to inject the connection string with the name "Fig", which is what Fig API expects.']}),"\n"]}),"\n",(0,r.jsx)(i.h2,{id:"alternative",children:"Alternative"}),"\n",(0,r.jsx)(i.p,{children:"If you don't want to use the Fig provided extension methods, Fig can also be added as docker containers (this is what the extensions are doing behind the scenes anyway)"}),"\n",(0,r.jsx)(i.pre,{children:(0,r.jsx)(i.code,{className:"language-csharp",children:'var figApi = builder.AddContainer("fig-api", "mzbrau/fig-api")\n    .WithImageTag("latest")\n    .WithHttpEndpoint(port: 7281, targetPort: 8080, name: "http")\n    .WithLifetime(ContainerLifetime.Persistent);\n\nvar figWeb = builder.AddContainer("fig-web", "mzbrau/fig-web")\n    .WithImageTag("latest")\n    .WithHttpEndpoint(port: 7148, targetPort: 80, name: "http")\n    .WithEnvironment("FIG_API_URI", figApi.GetEndpoint("http"))\n    .WaitFor(figApi)\n    .WithLifetime(ContainerLifetime.Persistent);\n'})}),"\n",(0,r.jsx)(i.h2,{id:"client-configuration-in-your-services",children:"Client Configuration in Your Services"}),"\n",(0,r.jsxs)(i.p,{children:["Once your services reference the Fig API, you need to configure the Fig client in your service's ",(0,r.jsx)(i.code,{children:"Program.cs"}),":"]}),"\n",(0,r.jsx)(i.pre,{children:(0,r.jsx)(i.code,{className:"language-csharp",children:'using Fig.Client;\nusing Fig.Client.Configuration;\n\nvar builder = WebApplication.CreateBuilder(args);\n\n// Add Fig as a configuration provider\nbuilder.Configuration.AddFig<AppSettings>(options =>\n{\n    options.ClientName = "MyService";\n    options.ClientSecret = "your-client-secret";\n    // FIG_API_URI is automatically set by Aspire\n});\n\nvar app = builder.Build();\napp.Run();\n'})}),"\n",(0,r.jsxs)(i.p,{children:["The ",(0,r.jsx)(i.code,{children:"FIG_API_URI"})," environment variable is automatically injected by Aspire, so you don't need to manually configure it."]}),"\n",(0,r.jsx)(i.h2,{id:"managing-aspire-set-settings",children:"Managing Aspire Set Settings"}),"\n",(0,r.jsx)(i.p,{children:"If Aspire is automatically setting some environment related settings, Fig may need to be configured to consume that setting."}),"\n",(0,r.jsx)(i.p,{children:"For example, imagine your application is using a NATS message bus and Aspire is wiring it up for you."}),"\n",(0,r.jsx)(i.pre,{children:(0,r.jsx)(i.code,{className:"language-csharp",children:'var nats = builder.AddNats("nats")\n    .WithLifetime(ContainerLifetime.Persistent);\n\nbuilder.AddProject<Projects.InventoryService>("inventoryservice")\n    .WithReference(nats);\n'})}),"\n",(0,r.jsxs)(i.p,{children:["In that case, an environment variable will be set with a specific address and Fig will need to be configured to consume that environment variable. You can use the ",(0,r.jsx)(i.a,{href:"/docs/next/features/settings-management/configuration-section",children:"ConfigurationSectionOverride"})," feature to set the setting in the correct location."]}),"\n",(0,r.jsx)(i.p,{children:"For example:"}),"\n",(0,r.jsx)(i.pre,{children:(0,r.jsx)(i.code,{className:"language-csharp",children:'[Setting("NATS server URL (e.g. nats://localhost:4222)")]\n[ConfigurationSectionOverride("ConnectionStrings", "nats")]\npublic string NatsUrl { get; set; } = "nats://localhost:4222";\n'})}),"\n",(0,r.jsx)(i.p,{children:"This will set the value from Aspire and mark the setting as externally managed."}),"\n",(0,r.jsx)(i.h2,{id:"troubleshooting",children:"Troubleshooting"}),"\n",(0,r.jsx)(i.h3,{id:"service-cant-connect-to-fig-api",children:"Service Can't Connect to Fig API"}),"\n",(0,r.jsx)(i.p,{children:"If your service can't connect to Fig API:"}),"\n",(0,r.jsxs)(i.ol,{children:["\n",(0,r.jsxs)(i.li,{children:["Verify the ",(0,r.jsx)(i.code,{children:"FIG_API_URI"})," environment variable is set in your service by checking the Aspire dashboard"]}),"\n",(0,r.jsxs)(i.li,{children:["Ensure your service has a reference to the Fig API: ",(0,r.jsx)(i.code,{children:".WithReference(figApi)"})]}),"\n",(0,r.jsx)(i.li,{children:"Check the Fig API container logs in the Aspire dashboard for any startup errors"}),"\n"]}),"\n",(0,r.jsx)(i.h3,{id:"fig-web-cant-connect-to-fig-api",children:"Fig Web Can't Connect to Fig API"}),"\n",(0,r.jsx)(i.p,{children:"If Fig Web shows connection errors:"}),"\n",(0,r.jsxs)(i.ol,{children:["\n",(0,r.jsxs)(i.li,{children:["Ensure you used ",(0,r.jsx)(i.code,{children:".WithFigApiReference(figApi)"})," when configuring Fig Web"]}),"\n",(0,r.jsx)(i.li,{children:"Check that Fig API is healthy and running in the Aspire dashboard"}),"\n",(0,r.jsx)(i.li,{children:"Verify the Fig API container is accessible on the configured port"}),"\n"]}),"\n",(0,r.jsx)(i.h3,{id:"containers-keep-restarting",children:"Containers Keep Restarting"}),"\n",(0,r.jsx)(i.p,{children:"If Fig containers keep restarting:"}),"\n",(0,r.jsxs)(i.ol,{children:["\n",(0,r.jsx)(i.li,{children:"Check container logs in the Aspire dashboard for error messages"}),"\n",(0,r.jsx)(i.li,{children:"Ensure you have enough resources (memory, CPU) allocated for Docker"}),"\n",(0,r.jsx)(i.li,{children:"Verify the Docker images are pulling correctly (check your internet connection)"}),"\n"]})]})}function g(e={}){const{wrapper:i}={...(0,s.R)(),...e.components};return i?(0,r.jsx)(i,{...e,children:(0,r.jsx)(l,{...e})}):l(e)}},28453(e,i,n){n.d(i,{R:()=>a,x:()=>o});var t=n(96540);const r={},s=t.createContext(r);function a(e){const i=t.useContext(s);return t.useMemo(function(){return"function"==typeof e?e(i):{...i,...e}},[i,e])}function o(e){let i;return i=e.disableParentContext?"function"==typeof e.components?e.components(r):e.components||r:a(e.components),t.createElement(s.Provider,{value:i},e.children)}}}]);