"use strict";(self.webpackChunkfig_documentation=self.webpackChunkfig_documentation||[]).push([[4747],{85344:(e,n,i)=>{i.r(n),i.d(n,{assets:()=>c,contentTitle:()=>a,default:()=>h,frontMatter:()=>o,metadata:()=>t,toc:()=>l});const t=JSON.parse('{"id":"guides/configuring-tls","title":"Configuring TLS","description":"Fig is able to run both its api and web instances with TLS enabled, provided the required environment variables and pem encoded certificate files are made available. This is aimed at use within docker containers, but equivalent configuration on host environments such as windows will also work for the api, but not the web instance.","source":"@site/docs/guides/5-configuring-tls.md","sourceDirName":"guides","slug":"/guides/configuring-tls","permalink":"/docs/next/guides/configuring-tls","draft":false,"unlisted":false,"editUrl":"https://github.com/mzbrau/fig/tree/main/doc/fig-documentation/docs/guides/5-configuring-tls.md","tags":[],"version":"current","sidebarPosition":5,"frontMatter":{"sidebar_position":5},"sidebar":"tutorialSidebar","previous":{"title":"Integration Testing ASP.NET Core Apps","permalink":"/docs/next/guides/integration-testing"},"next":{"title":"Fig Version 1.x to 2.x Migration Guide","permalink":"/docs/next/guides/version1-version2-migration-guide"}}');var r=i(74848),s=i(28453);const o={sidebar_position:5},a="Configuring TLS",c={},l=[{value:"Fig Api",id:"fig-api",level:2},{value:"Fig Web",id:"fig-web",level:2}];function d(e){const n={code:"code",h1:"h1",h2:"h2",header:"header",li:"li",ol:"ol",p:"p",pre:"pre",ul:"ul",...(0,s.R)(),...e.components};return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(n.header,{children:(0,r.jsx)(n.h1,{id:"configuring-tls",children:"Configuring TLS"})}),"\n",(0,r.jsx)(n.p,{children:"Fig is able to run both its api and web instances with TLS enabled, provided the required environment variables and pem encoded certificate files are made available. This is aimed at use within docker containers, but equivalent configuration on host environments such as windows will also work for the api, but not the web instance."}),"\n",(0,r.jsx)(n.h2,{id:"fig-api",children:"Fig Api"}),"\n",(0,r.jsx)(n.p,{children:"To enable this within the Fig-Api docker container:"}),"\n",(0,r.jsxs)(n.ol,{children:["\n",(0,r.jsxs)(n.li,{children:["\n",(0,r.jsx)(n.p,{children:"Define the SSL_CERT_PATH, SSL_KEY_PATH, and FIG_API_SSL_PORT environment variables:"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"SSL_CERT_PATH: The path to the full chain pem encoded certificate"}),"\n",(0,r.jsx)(n.li,{children:"SSL_KEY_PATH: The path to the pem encoded private key"}),"\n",(0,r.jsx)(n.li,{children:"FIG_API_SSL_PORT: The port that the api will listen on for https requests"}),"\n"]}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:["\n",(0,r.jsx)(n.p,{children:"Mount the pem encoded certificate and key at the paths defined in the corresponding path variables"}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:["\n",(0,r.jsx)(n.p,{children:"Update the port mapping and health check to match the https port that Fig-Api is now listening at. Below is an example docker-compose file snippet representing the required configuration."}),"\n"]}),"\n"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-yaml",children:'fig-api:\r\n  image: mzbrau/fig-api:latest\r\n  container_name: fig-api\r\n  ports:\r\n    - "7281:7148"\r\n  depends_on:\r\n    fig-setup:\r\n      condition: service_completed_successfully\r\n  environment:\r\n    - ApiSettings:DbConnectionString=Server=${fqdn};User Id=${FIG_USER_NAME};Password=${FIG_DB_PWD};Initial Catalog=${FIG_DB_NAME}\r\n    - SSL_CERT_PATH=/usr/bin/certs/fig.pem\r\n    - SSL_KEY_PATH=/usr/bin/certs/fig.key\r\n    - FIG_API_SSL_PORT=7148\r\n  volumes:\r\n    - ./fig.pem:/usr/bin/certs/fig.pem\r\n    - ./fig.key:/usr/bin/certs/fig.key\r\n  healthcheck:\r\n    test: ["CMD", "curl", "-f", "https://localhost:7148/_health"]\r\n    start_period: 30s\r\n    interval: 5s\r\n    timeout: 10s\r\n    retries: 3\n'})}),"\n",(0,r.jsx)(n.h2,{id:"fig-web",children:"Fig Web"}),"\n",(0,r.jsx)(n.p,{children:"To enable this within the Fig-Web docker container:"}),"\n",(0,r.jsxs)(n.ol,{children:["\n",(0,r.jsxs)(n.li,{children:["\n",(0,r.jsx)(n.p,{children:"Define the SSL_CERT_PATH, SSL_KEY_PATH, FIG_API_SSL_PORT, and optionally SSL_TRUSTED_CERT_PATH environment variables:"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"SSL_CERT_PATH: The path to the full chain pem encoded certificate"}),"\n",(0,r.jsx)(n.li,{children:"SSL_KEY_PATH: The path to the pem encoded private key"}),"\n",(0,r.jsx)(n.li,{children:"FIG_API_SSL_PORT: The port that the web instance will run on"}),"\n",(0,r.jsx)(n.li,{children:"SSL_TRUSTED_CERT_PATH: The path to a pem encoded trusted certificate."}),"\n"]}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:["\n",(0,r.jsx)(n.p,{children:"Mount the pem encoded certificate, key, and optionally trusted certificate at the paths defined in the corresponding path variables"}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:["\n",(0,r.jsx)(n.p,{children:"Update the port mapping and health check to match the https port that Fig-Web is now listening at. Below is an example docker-compose file snippet representing the required configuration."}),"\n"]}),"\n"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-yaml",children:'fig-web:\r\n  image: mzbrau/fig-web:latest\r\n  container_name: fig-web\r\n  ports:\r\n    - "7148:443"\r\n  depends_on:\r\n    fig-api:\r\n      condition: service_healthy\r\n  environment:\r\n    - FIG_API_URI=https://localhost:7281\r\n    - SSL_CERT_PATH=/usr/local/nginx/certs/fig.pem\r\n    - SSL_KEY_PATH=/usr/local/nginx/certs/fig.key\r\n    - SSL_TRUSTED_CERT_PATH=/usr/local/nginx/certs/ca.pem\r\n    - FIG_WEB_SSL_PORT=443\r\n  volumes:\r\n    - ./fig.key:/usr/local/nginx/certs/fig.key\r\n    - ./fig.pem:/usr/local/nginx/certs/fig.pem\r\n    - ./ca.pem:/usr/local/nginx/certs/ca.pem\r\n  healthcheck:\r\n    test: ["CMD", "curl", "-f", "https://localhost:443"]\r\n    start_period: 30s      \r\n    interval: 5s\r\n    timeout: 10s\r\n    retries: 3\n'})})]})}function h(e={}){const{wrapper:n}={...(0,s.R)(),...e.components};return n?(0,r.jsx)(n,{...e,children:(0,r.jsx)(d,{...e})}):d(e)}},28453:(e,n,i)=>{i.d(n,{R:()=>o,x:()=>a});var t=i(96540);const r={},s=t.createContext(r);function o(e){const n=t.useContext(s);return t.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function a(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(r):e.components||r:o(e.components),t.createElement(s.Provider,{value:n},e.children)}}}]);