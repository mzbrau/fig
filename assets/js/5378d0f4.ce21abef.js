"use strict";(self.webpackChunkfig_documentation=self.webpackChunkfig_documentation||[]).push([[3496],{38491:(e,n,i)=>{i.r(n),i.d(n,{assets:()=>c,contentTitle:()=>l,default:()=>h,frontMatter:()=>o,metadata:()=>t,toc:()=>d});const t=JSON.parse('{"id":"integrations/fig-sentinel-connector","title":"Fig Microsoft Sentinel Integration","description":"This integration forwards Fig webhook events to Microsoft Sentinel for Security Information and Event Management (SIEM) monitoring.","source":"@site/docs/integrations/fig-sentinel-connector.md","sourceDirName":"integrations","slug":"/integrations/fig-sentinel-connector","permalink":"/docs/next/integrations/fig-sentinel-connector","draft":false,"unlisted":false,"editUrl":"https://github.com/mzbrau/fig/tree/main/doc/fig-documentation/docs/integrations/fig-sentinel-connector.md","tags":[],"version":"current","sidebarPosition":1,"frontMatter":{"sidebar_position":1},"sidebar":"tutorialSidebar","previous":{"title":"Integrations","permalink":"/docs/next/category/integrations"},"next":{"title":"Examples","permalink":"/docs/next/examples"}}');var s=i(74848),r=i(28453);const o={sidebar_position:1},l="Fig Microsoft Sentinel Integration",c={},d=[{value:"Features",id:"features",level:2},{value:"Configuration",id:"configuration",level:2},{value:"Required Settings",id:"required-settings",level:3},{value:"Optional Settings",id:"optional-settings",level:3},{value:"Setup",id:"setup",level:2},{value:"1. Microsoft Sentinel Workspace",id:"1-microsoft-sentinel-workspace",level:3},{value:"2. Fig Configuration",id:"2-fig-configuration",level:3},{value:"3. Running the Integration",id:"3-running-the-integration",level:3},{value:"Using Docker Compose (Recommended)",id:"using-docker-compose-recommended",level:4},{value:"Using Docker Run",id:"using-docker-run",level:4},{value:"Using .NET",id:"using-net",level:4},{value:"4. Configure Fig Webhooks",id:"4-configure-fig-webhooks",level:3},{value:"Webhook Endpoints",id:"webhook-endpoints",level:2},{value:"Microsoft Sentinel Log Structure",id:"microsoft-sentinel-log-structure",level:2},{value:"Querying Logs in Sentinel",id:"querying-logs-in-sentinel",level:2},{value:"Health Monitoring",id:"health-monitoring",level:2},{value:"Security Considerations",id:"security-considerations",level:2},{value:"Client Secret Management",id:"client-secret-management",level:3},{value:"Additional Security Best Practices",id:"additional-security-best-practices",level:3},{value:"Troubleshooting",id:"troubleshooting",level:2},{value:"Common Issues",id:"common-issues",level:3},{value:"Logs",id:"logs",level:3},{value:"Health Check",id:"health-check",level:3},{value:"Development",id:"development",level:2}];function a(e){const n={admonition:"admonition",code:"code",h1:"h1",h2:"h2",h3:"h3",h4:"h4",header:"header",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,r.R)(),...e.components};return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(n.header,{children:(0,s.jsx)(n.h1,{id:"fig-microsoft-sentinel-integration",children:"Fig Microsoft Sentinel Integration"})}),"\n",(0,s.jsx)(n.p,{children:"This integration forwards Fig webhook events to Microsoft Sentinel for Security Information and Event Management (SIEM) monitoring."}),"\n",(0,s.jsx)(n.admonition,{title:"Experimental",type:"warning",children:(0,s.jsx)(n.p,{children:"This integration is experimental and may not work as expected. Create a ticket on GitHub if a problem is found."})}),"\n",(0,s.jsx)(n.h2,{id:"features",children:"Features"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Security Event Monitoring"}),": Forwards login attempts, user creation events, and other security events"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Configuration Change Tracking"}),": Monitors setting value changes across your applications"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Client Health Monitoring"}),": Tracks client registrations, status changes, and health events"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Configurable Event Filtering"}),": Choose which event types to process and forward"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Robust Error Handling"}),": Built-in retry logic with exponential backoff"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Health Checks"}),": Monitor the integration's connection to Microsoft Sentinel"]}),"\n"]}),"\n",(0,s.jsx)(n.h2,{id:"configuration",children:"Configuration"}),"\n",(0,s.jsx)(n.p,{children:"The integration uses Fig for configuration management. You'll need to configure the following settings in Fig:"}),"\n",(0,s.jsx)(n.h3,{id:"required-settings",children:"Required Settings"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"HashedSecret"}),": The hashed secret provided by Fig when configuring the webhook client"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"SentinelWorkspaceId"}),": Your Microsoft Sentinel workspace ID (Customer ID from workspace settings)"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"SentinelWorkspaceKey"}),": Your Microsoft Sentinel workspace primary or secondary key"]}),"\n"]}),"\n",(0,s.jsx)(n.h3,{id:"optional-settings",children:"Optional Settings"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"SentinelLogType"}),': Custom log type name in Sentinel (default: "FigEvents")']}),"\n"]}),"\n",(0,s.jsx)(n.h2,{id:"setup",children:"Setup"}),"\n",(0,s.jsx)(n.h3,{id:"1-microsoft-sentinel-workspace",children:"1. Microsoft Sentinel Workspace"}),"\n",(0,s.jsxs)(n.ol,{children:["\n",(0,s.jsx)(n.li,{children:"In the Azure portal, navigate to your Microsoft Sentinel workspace"}),"\n",(0,s.jsxs)(n.li,{children:["Go to ",(0,s.jsx)(n.strong,{children:"Settings"})," > ",(0,s.jsx)(n.strong,{children:"Workspace settings"})]}),"\n",(0,s.jsxs)(n.li,{children:["Copy the ",(0,s.jsx)(n.strong,{children:"Customer ID"})," (this is your ",(0,s.jsx)(n.code,{children:"SentinelWorkspaceId"}),")"]}),"\n",(0,s.jsxs)(n.li,{children:["Go to ",(0,s.jsx)(n.strong,{children:"Agents management"})," > ",(0,s.jsx)(n.strong,{children:"Log Analytics agent instructions"})]}),"\n",(0,s.jsxs)(n.li,{children:["Copy the ",(0,s.jsx)(n.strong,{children:"Primary key"})," or ",(0,s.jsx)(n.strong,{children:"Secondary key"})," (this is your ",(0,s.jsx)(n.code,{children:"SentinelWorkspaceKey"}),")"]}),"\n"]}),"\n",(0,s.jsx)(n.h3,{id:"2-fig-configuration",children:"2. Fig Configuration"}),"\n",(0,s.jsxs)(n.ol,{children:["\n",(0,s.jsx)(n.li,{children:"Register the integration as a webhook client in Fig"}),"\n",(0,s.jsx)(n.li,{children:"Configure the required settings mentioned above"}),"\n",(0,s.jsx)(n.li,{children:"Note the hashed secret provided by Fig for webhook authentication"}),"\n"]}),"\n",(0,s.jsx)(n.h3,{id:"3-running-the-integration",children:"3. Running the Integration"}),"\n",(0,s.jsx)(n.h4,{id:"using-docker-compose-recommended",children:"Using Docker Compose (Recommended)"}),"\n",(0,s.jsx)(n.p,{children:"The recommended approach uses Docker secrets for secure configuration:"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-bash",children:'# Create secrets directory\nmkdir -p secrets\n\n# Store your client secret securely\necho "your-client-secret" > secrets/fig_client_secret.txt\nchmod 600 secrets/fig_client_secret.txt\n\n# Update docker-compose.yml with your Fig API URL\n# Then start the service\ndocker compose up -d\n'})}),"\n",(0,s.jsxs)(n.p,{children:["The integration uses Docker secrets which are mounted at ",(0,s.jsx)(n.code,{children:"/run/secrets/FIG_FigSentinelConnector_SECRET.txt"})," in the container. The Fig client automatically reads this secret file for authentication."]}),"\n",(0,s.jsx)(n.h4,{id:"using-docker-run",children:"Using Docker Run"}),"\n",(0,s.jsx)(n.p,{children:"For simple testing (less secure):"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-bash",children:'docker run -d \\\n  --name fig-sentinel-integration \\\n  -p 8080:80 \\\n  -e FIG_API_URI="https://your-fig-api-url" \\\n  -e FIG_MicrosoftSentinelIntegration_SECRET="your-client-secret" \\\n  mzbrau/fig-sentinel-integration:latest\n'})}),"\n",(0,s.jsx)(n.admonition,{title:"Security",type:"warning",children:(0,s.jsx)(n.p,{children:"Using environment variables exposes secrets in process lists and Docker inspect output. Use Docker secrets or secret files for production deployments."})}),"\n",(0,s.jsx)(n.h4,{id:"using-net",children:"Using .NET"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-bash",children:'cd src/integrations/Fig.Integration.MicrosoftSentinel\nexport FIG_API_URI="https://your-fig-api-url"\nexport FIG_MicrosoftSentinelIntegration_SECRET="your-client-secret"\ndotnet run\n'})}),"\n",(0,s.jsx)(n.h3,{id:"4-configure-fig-webhooks",children:"4. Configure Fig Webhooks"}),"\n",(0,s.jsx)(n.p,{children:"In the Fig web application:"}),"\n",(0,s.jsxs)(n.ol,{children:["\n",(0,s.jsxs)(n.li,{children:["Go to ",(0,s.jsx)(n.strong,{children:"Webhooks"})," section"]}),"\n",(0,s.jsx)(n.li,{children:"Add a new webhook pointing to your integration endpoint"}),"\n",(0,s.jsxs)(n.li,{children:["Set the URL to ",(0,s.jsx)(n.code,{children:"http://your-integration-host:port/[EventType]"})]}),"\n",(0,s.jsx)(n.li,{children:"Choose the event types you want to forward"}),"\n",(0,s.jsx)(n.li,{children:"Use the client secret for authentication"}),"\n"]}),"\n",(0,s.jsx)(n.h2,{id:"webhook-endpoints",children:"Webhook Endpoints"}),"\n",(0,s.jsx)(n.p,{children:"The integration provides the following endpoints for different event types:"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.code,{children:"POST /SecurityEvent"})," - Security events (login attempts, user creation)"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.code,{children:"POST /SettingValueChanged"})," - Setting value changes"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.code,{children:"POST /ClientRegistration"})," - Client registrations"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.code,{children:"POST /ClientStatusChanged"})," - Client connection status changes"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.code,{children:"POST /ClientHealthChanged"})," - Client health status changes"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.code,{children:"POST /MinRunSessions"})," - Minimum run sessions events"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.code,{children:"GET /_health"})," - Health check endpoint"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.code,{children:"GET /"})," - Basic service information"]}),"\n"]}),"\n",(0,s.jsx)(n.h2,{id:"microsoft-sentinel-log-structure",children:"Microsoft Sentinel Log Structure"}),"\n",(0,s.jsx)(n.p,{children:"Events are sent to Sentinel with the following structure:"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-json",children:'{\n  "timestamp": "2024-01-15T10:30:00Z",\n  "eventType": "SecurityEvent",\n  "figEventType": "Login",\n  "username": "admin",\n  "success": false,\n  "ipAddress": "192.168.1.100",\n  "hostname": "workstation-01",\n  "failureReason": "Invalid password",\n  "source": "Fig",\n  "integration": "MicrosoftSentinel",\n  "severity": "Medium"\n}\n'})}),"\n",(0,s.jsx)(n.h2,{id:"querying-logs-in-sentinel",children:"Querying Logs in Sentinel"}),"\n",(0,s.jsxs)(n.p,{children:["Once configured, logs will appear in Microsoft Sentinel under the custom log type (default: ",(0,s.jsx)(n.code,{children:"FigEvents_CL"}),"). You can query them using KQL:"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-kql",children:'// View all Fig events\nFigEvents_CL\n| order by TimeGenerated desc\n\n// View failed login attempts\nFigEvents_CL\n| where eventType_s == "SecurityEvent"\n| where success_b == false\n| order by TimeGenerated desc\n\n// View setting changes\nFigEvents_CL\n| where eventType_s == "SettingValueChanged"\n| order by TimeGenerated desc\n'})}),"\n",(0,s.jsx)(n.h2,{id:"health-monitoring",children:"Health Monitoring"}),"\n",(0,s.jsxs)(n.p,{children:["The integration includes health checks accessible at ",(0,s.jsx)(n.code,{children:"/_health"}),". The health check validates the connection to Microsoft Sentinel by sending a test log entry."]}),"\n",(0,s.jsx)(n.h2,{id:"security-considerations",children:"Security Considerations"}),"\n",(0,s.jsx)(n.h3,{id:"client-secret-management",children:"Client Secret Management"}),"\n",(0,s.jsxs)(n.p,{children:["The integration requires a client secret for authentication with the Fig API. ",(0,s.jsx)(n.strong,{children:"Never commit secrets to version control."})]}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"Recommended approaches (in order of security):"})}),"\n",(0,s.jsxs)(n.ol,{children:["\n",(0,s.jsxs)(n.li,{children:["\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.strong,{children:"Docker Secrets"})," (Production): Secrets are mounted as read-only in-memory files at ",(0,s.jsx)(n.code,{children:"/run/secrets/"})]}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:["See ",(0,s.jsx)(n.code,{children:"SECRETS_SETUP.md"})," for detailed configuration"]}),"\n",(0,s.jsx)(n.li,{children:"Secrets are isolated from environment variables and process lists"}),"\n",(0,s.jsx)(n.li,{children:"Supported by Docker Swarm and can be used with Docker Compose"}),"\n"]}),"\n"]}),"\n",(0,s.jsxs)(n.li,{children:["\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.strong,{children:"External Secret Management"})," (Enterprise):"]}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"Azure Key Vault"}),"\n",(0,s.jsx)(n.li,{children:"AWS Secrets Manager"}),"\n",(0,s.jsx)(n.li,{children:"HashiCorp Vault"}),"\n",(0,s.jsx)(n.li,{children:"Kubernetes Secrets"}),"\n"]}),"\n"]}),"\n",(0,s.jsxs)(n.li,{children:["\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.strong,{children:"Environment Files"})," (Development): Use ",(0,s.jsx)(n.code,{children:".env"})," files excluded from version control"]}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:["Set restrictive permissions: ",(0,s.jsx)(n.code,{children:"chmod 600 .env"})]}),"\n",(0,s.jsxs)(n.li,{children:["Add to ",(0,s.jsx)(n.code,{children:".gitignore"})]}),"\n",(0,s.jsx)(n.li,{children:"Suitable for local development only"}),"\n"]}),"\n"]}),"\n",(0,s.jsxs)(n.li,{children:["\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.strong,{children:"Environment Variables"})," (Testing only): Least secure, avoid in production"]}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:["Visible in process lists (",(0,s.jsx)(n.code,{children:"ps aux"}),")"]}),"\n",(0,s.jsxs)(n.li,{children:["Exposed in ",(0,s.jsx)(n.code,{children:"docker inspect"})," output"]}),"\n",(0,s.jsx)(n.li,{children:"Can leak in logs and error messages"}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,s.jsx)(n.h3,{id:"additional-security-best-practices",children:"Additional Security Best Practices"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"Use the webhook authentication feature to secure your integration endpoint"}),"\n",(0,s.jsx)(n.li,{children:"Store the Sentinel workspace key securely (use Fig's secret setting type)"}),"\n",(0,s.jsx)(n.li,{children:"Use HTTPS for webhook endpoints in production"}),"\n",(0,s.jsx)(n.li,{children:"Implement network segmentation to restrict access to the integration"}),"\n",(0,s.jsx)(n.li,{children:"Monitor the integration logs for any authentication or connectivity issues"}),"\n",(0,s.jsx)(n.li,{children:"Rotate secrets regularly following your organization's security policy"}),"\n",(0,s.jsx)(n.li,{children:"Use firewall rules to restrict inbound connections to trusted sources only"}),"\n"]}),"\n",(0,s.jsx)(n.h2,{id:"troubleshooting",children:"Troubleshooting"}),"\n",(0,s.jsx)(n.h3,{id:"common-issues",children:"Common Issues"}),"\n",(0,s.jsxs)(n.ol,{children:["\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Authentication Failed"}),": Verify the HashedSecret matches what's configured in Fig"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Sentinel Connection Failed"}),": Check SentinelWorkspaceId and SentinelWorkspaceKey"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"No Events Received"}),": Verify webhook configuration in Fig points to correct endpoints"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Events Not Appearing in Sentinel"}),": Check that at least one event type is enabled for processing"]}),"\n"]}),"\n",(0,s.jsx)(n.h3,{id:"logs",children:"Logs"}),"\n",(0,s.jsxs)(n.p,{children:["The integration logs to both console and file (",(0,s.jsx)(n.code,{children:"logs/sentinel-integration-*.log"}),"). Check these logs for detailed error information."]}),"\n",(0,s.jsx)(n.h3,{id:"health-check",children:"Health Check"}),"\n",(0,s.jsxs)(n.p,{children:["Use the ",(0,s.jsx)(n.code,{children:"/_health"})," endpoint to verify the integration's connection to Microsoft Sentinel:"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-bash",children:"curl http://your-integration-host:port/_health\n"})}),"\n",(0,s.jsx)(n.h2,{id:"development",children:"Development"}),"\n",(0,s.jsx)(n.p,{children:"To extend or modify the integration:"}),"\n",(0,s.jsxs)(n.ol,{children:["\n",(0,s.jsx)(n.li,{children:"Clone the Fig repository"}),"\n",(0,s.jsxs)(n.li,{children:["Navigate to ",(0,s.jsx)(n.code,{children:"src/integrations/Fig.Integration.MicrosoftSentinel"})]}),"\n",(0,s.jsx)(n.li,{children:"Make your changes"}),"\n",(0,s.jsxs)(n.li,{children:["Build and test: ",(0,s.jsx)(n.code,{children:"dotnet build && dotnet run"})]}),"\n"]}),"\n",(0,s.jsx)(n.p,{children:"The integration follows Fig's established patterns and can be used as a template for other SIEM integrations."})]})}function h(e={}){const{wrapper:n}={...(0,r.R)(),...e.components};return n?(0,s.jsx)(n,{...e,children:(0,s.jsx)(a,{...e})}):a(e)}},28453:(e,n,i)=>{i.d(n,{R:()=>o,x:()=>l});var t=i(96540);const s={},r=t.createContext(s);function o(e){const n=t.useContext(r);return t.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function l(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(s):e.components||s:o(e.components),t.createElement(r.Provider,{value:n},e.children)}}}]);